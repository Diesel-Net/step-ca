# docker-compose.yaml

version: '3.8'
services: 

  server:
    image: smallstep/step-ca:0.16.0
    volumes:
      - /etc/localtime:/etc/localtime
      - /etc/ssl/certs/:/etc/ssl/certs/
      - {{ config_dir }}/:/home/step/
    networks:
      - {{ traefik_network }}
    environment:
      - STEPDEBUG=1
    deploy:
      labels:
        - traefik.enable=true
        - traefik.tcp.services.{{ git_repository }}.loadbalancer.server.port=443
        - traefik.tcp.routers.{{ git_repository }}.rule=HostSNI(`{{ domain }}`)
        - traefik.tcp.routers.{{ git_repository }}.tls.passthrough=true
networks:
  {{ traefik_network }}:
    external:
      name: {{ traefik_network }}
